!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).NicePassWord=e()}(this,(function(){"use strict";function t(t,{type:e="password",symbol:i="*",callback:n=()=>{},pattern:s=/([\u4e00-\u9fa5])/g}={}){let r=this;if(r.input="string"==typeof t?document.getElementById(0===t.indexOf("#")?t.substr(1):t):t,!r.input||!r.input.tagName||"input"!=r.input.tagName.toLowerCase()||"password"===r.input.type)throw new Error("请传一个type为text的input的id或HTMLInputElement！");return r.input.valueProxy="",r.callback=n,r.type=e,r.symbol=i,r.symbolRegExp=new RegExp(r.symbol.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),r.pattern=s,r.cursor=0,r.isInit=!1,Object.defineProperty(r,"value",{get:()=>r.input.valueProxy}),r.init(),r}return t.prototype.init=function(){this.$setValue(),this._preventDefaultEvent(),this._bindEvent(),this.isInit=!0},t.prototype._preventDefaultEvent=function(t){function e(){var t=t||window.event;t.preventDefault()}this.input.addEventListener("copy",e),this.input.addEventListener("cut",e),this.input.addEventListener("dragenter",(function(t){return t.preventDefault(),this.warn("_dragenterhandlder"),this.setAttribute("readonly",!0),!1})),this.input.addEventListener("dragleave",(function(t){return t.preventDefault(),this.warn("_dragleaveHandler"),this.removeAttribute("readonly"),!1})),this.input.addEventListener("mousedown",(function(t){return 0===t.button&&this.selectionStart!=this.selectionEnd&&(this.selectionStart=this.selectionEnd=this.value.length),!1}))},t.prototype._bindEvent=function(){this.input.addEventListener("compositionstart",(()=>{this.lock=!0,this.warn("start")})),this.input.addEventListener("compositionend",(()=>{this.lock=!1,this.warn("end"),this._inputHandler()})),this.input.addEventListener("input",this._inputHandler.bind(this)),this.input.addEventListener("propertychange",this._inputHandler.bind(this))},t.prototype._inputHandler=function(){this.lock||(this.isInit?this.warn("input"):this.warn("init"),"password"===this.type?this._passwordHandler():this._textHandler(),this._showValue(),this._setCursor(),"function"==typeof this.callback&&this.callback())},t.prototype._passwordHandler=function(){var t=this,e=this._filterCn(this.input.value).split(""),i=this.input.valueProxy.split(""),n=e.length-i.length,s=this.input.selectionStart,r=s-this.input.value.split("").length+e.length;if(n>0){var o=e.join("").replace(this.symbolRegExp,"").split(""),u=e.length-s>0?i.slice(-(e.length-s)):[];i=[].concat(i.slice(0,s-o.length),o,u),console.log(o,this.symbolRegExp)}n<0&&i.splice(s,Math.abs(n)),e.forEach((function(e,n){e!=t.symbol&&(i[n]=e)})),this.input.valueProxy=i.join(""),this.cursor=r},t.prototype._filterCn=function(t,e){if(!t)return t;var i=this.pattern;e=e||"";return t.replace(i,e)},t.prototype._textHandler=function(){this.input.valueProxy=this._filterCn(this.input.value),this.cursor=this.input.selectionStart-this.input.value.split("").length+this.input.valueProxy.split("").length},t.prototype._showValue=function(){var t="";"password"===this.type?this.value.split("").forEach((e=>{t+=this.symbol})):t=this.value,this.input.value=t},t.prototype._setCursor=function(){this.input.selectionStart=this.cursor,this.input.selectionEnd=this.cursor},t.prototype.warn=function(t){console.log(t)},t.prototype.$setValue=function(t){t&&(this.input.value=t),this._inputHandler()},t.prototype.$changeType=function(t){this.type=t,this.$setValue(this.value)},t}));
